# ğŸ”§ VersÃµes fixas (evita puxar Airflow 3.x instÃ¡vel)
FROM apache/airflow:2.10.2-python3.11

# ğŸ Instalar dependÃªncias adicionais do Python
# - Spark Provider para integraÃ§Ã£o com Spark
# - pandas e numpy para manipulaÃ§Ã£o de dados
RUN pip install --no-cache-dir \
    apache-airflow-providers-apache-spark \
    pandas \
    numpy

# âš™ï¸ Mudar para root para instalar utilitÃ¡rios bÃ¡sicos
USER root
RUN apt-get update --allow-releaseinfo-change \
  && apt-get install -y --no-install-recommends \
       wget \
       curl \
       ca-certificates \
       procps \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

# ğŸ§¼ Garantir permissÃµes corretas para Airflow
RUN mkdir -p /opt/airflow && chown -R 50000:0 /opt/airflow

# ğŸ‘¤ Voltar para usuÃ¡rio padrÃ£o do Airflow
USER 50000:0

# ğŸš Entrar no bash por padrÃ£o (Ãºtil para debug)
CMD ["bash"]
