# üîß Vers√£o fixa do Airflow (evita Airflow 3)
FROM apache/airflow:2.10.2-python3.11

# 1Ô∏è‚É£ Instalar depend√™ncias Python como usu√°rio airflow
USER airflow

RUN pip install --no-cache-dir \
    apache-airflow-providers-apache-spark==4.6.0 \
    pyspark==3.5.1 \
    pandas==2.1.4 \
    numpy==1.26.4

# 2Ô∏è‚É£ Voltar para root para instalar utilit√°rios do sistema
USER root

RUN apt-get update --allow-releaseinfo-change \
  && apt-get install -y --no-install-recommends \
       wget \
       curl \
       ca-certificates \
       procps \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

# 3Ô∏è‚É£ Ajustar permiss√µes do diret√≥rio do Airflow
RUN mkdir -p /opt/airflow && chown -R 50000:0 /opt/airflow

# 4Ô∏è‚É£ Voltar para usu√°rio correto do Airflow
USER 50000:0
